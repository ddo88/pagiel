function VM(){var s=this;return s.currentList=ko.observable(),s.files=ko.observableArray(),s.selectedFiles=ko.observable(),s.tonos=[],s.processPosition=function(e,o){var i=s.files();_.find(i,function(t,n){return e.id()==t.id()&&(i.move(n,n+o),t)}),s.files([]),s.files(_.filter(i),function(t){return t})},s.up=function(t){s.processPosition(t,1)},s.down=function(t){s.processPosition(t,-1)},s.cleanList=function(){confirm("¿seguro de limpiar la lista?")&&(s.files([]),s.saveList(),location.reload())},s.buscar=function(){s.files([]);var t=void 0,t=s.selectedFiles()?s.selectedFiles().value():_.map(s.currentList().Songs,function(t){return t});For(t,function(t,n){t=getSync("/api/songs/"+t),t=new Song(t,s);t.tono(s.tonos[n]||0),s.files.push(t)})},s.generar=function(){confirm("¿esta seguro de guardar la información?")&&s.saveList()},s.saveList=function(){var t={data:JSON.stringify(_.map(s.files(),function(t){return{id:t.id(),tono:t.tono()}}))};s.currentList()?(t.id=s.currentList()._id,updateItem("/api/lists",t).done(function(t){alert("se ha guardado correctamente la información")})):postItem("/api/lists",t).done(function(t){alert("se ha guardado correctamente la información")})},s.UpdateSongsStatistics=function(){confirm("esta seguro de actualizar la lista?")&&(For(_.chain(s.files()).map(function(t){return t.id()}).reduce(function(t,n){return t+","+n}).value().split(","),function(t){updateItem("/api/songs/"+t,{}).done(function(t){console.log(t)})}),postItem("/api/lists/history",{}).done(function(){alert("se ha guardado correctamente la información"),console.log("update")}))},s.goToPresentation=function(){window.location.href="/presentation"},s.goToPresentationChords=function(){window.location.href="/presentationChords"},s.goToSongs=function(){window.location.href="/songs"},s.init=function(){s.initMultiselect(),s.files([]),s.selectedFiles($("#required").data("kendoMultiSelect")),get("/api/lists/current").done(function(t){if(t.length){s.currentList(t[0]);t=_.map(s.currentList().Songs,function(t){return t.id});s.tonos=_.map(s.currentList().Songs,function(t){return t.tono});try{s.selectedFiles().value(t)}catch(t){}setTimeout(function(){s.buscar()},2e3)}})},s.initMultiselect=function(){$("#required").kendoMultiSelect({dataSource:{transport:{read:{dataType:"json",url:"/api/songs"}}},itemTemplate:'<span class="k-state-default">#:data.Name#</span><span class="k-state-default"><p>#: data.Type #</p></span>',dataTextField:"Name",dataValueField:"_id",change:s.buscar,tagMode:"single",height:250,maxSelectedItems:10})},s.init(),s}Array.prototype.move=function(t,n){for(;t<0;)t+=this.length;if(!(n<0)){if(n>=this.length)for(var e=n-this.length;1+e--;)this.push(void 0);return this.splice(n,0,this.splice(t,1)[0]),this}},Song.prototype.Up=function(){this.tono(this.tono()+1)},Song.prototype.Down=function(){this.tono(this.tono()-1)},$(function(){try{$(document).tooltip({items:".custom-tooltip",content:function(){return $(this).find(".custom-tooltip-message").html()}})}catch(t){console.log(t)}ko.applyBindings(new VM)});